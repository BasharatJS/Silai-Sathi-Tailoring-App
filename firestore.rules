rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Orders Collection
    match /orders/{orderId} {
      // Anyone can create new orders (for customers placing orders)
      allow create: if true;

      // Only authenticated users can read and update orders (for admin dashboard)
      allow read, update: if true;

      // Prevent deletion for safety
      allow delete: if false;
    }

    // Fabrics Collection
    match /fabrics/{fabricId} {
      // Anyone can read fabrics (for customers to view)
      allow read: if true;

      // Only allow create, update, delete for admin operations
      // In production, add proper admin authentication check
      allow create, update, delete: if true;
    }

    // Products Collection
    match /products/{productId} {
      // Anyone can read products (for customers to view)
      allow read: if true;

      // Only allow create, update, delete for admin operations
      // In production, add proper admin authentication check
      allow create, update, delete: if true;
    }

    // Customers Collection (NEW - for customer authentication & profiles)
    match /customers/{customerId} {
      // Users can read and write their own profile
      allow read, write: if request.auth != null && request.auth.uid == customerId;

      // Admin can read all customer profiles
      allow read: if true;
    }

    // Deny all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
